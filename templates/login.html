{% extends "_layouts/base.html" %}


{% block main %}

    <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="potyk_io_bot"
            data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
    <script type="text/javascript">
        async function onTelegramAuth(user) {
            const resp = await fetch(
                'https://functions.yandexcloud.net/d4egqbhi7fbj2euj7tca',
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(user)
                }
            )
            if (resp.status === 200) {
                localStorage.setItem('tgAuth', JSON.stringify(user))
                window.location.href = '/';
            } else {
                alert('–ù–µ –ø–æ–≤–µ–∑–ª–æ —Ç–µ–±–µ üêº')
            }
        }
    </script>


{% endblock %}