{% extends "_layouts/base.html" %}


{% block main %}

    <div class="flex justify-center">
        <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="potyk_io_bot"
                data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
    </div>

    <h2>–ó–∞—á–µ–º –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è?</h2>

    <p>–ú–µ–Ω—è —á–∏—Ç–∞—é—Ç –ø–æ–ª—Ç–æ—Ä–∞ –∞–Ω–æ–Ω–∏–º–∞, —Ö–æ—á–µ—Ç—Å—è –∑–Ω–∞—Ç—å —Ç–∞–∫–∏—Ö –ª—é–¥–µ–π –≤ –ª–∏—Ü–æ</p>

    <h2>–ö—É–¥–∞ —è –ø–æ–ø–∞–ª?</h2>

    <p>–≠—Ç–æ –±–ª–æ–≥ –ø–æ—Ç–∏–∫–∞, –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –º–æ–∏ –Ω–æ–≤–æ—Å—Ç–∏, –ø–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ –ø–∏–≤–æ, –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Ñ–∏–ª—å–º–∞–º–∏/–∏–≥—Ä–∞–º–∏/–∫–Ω–∏–≥–∞–º–∏,
        –∫–æ—Ç–æ—Ä—ã–µ —è –ø–æ—Ç—Ä–µ–±–∏–ª, –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ</p>

    <h2>–ê –µ—Å–ª–∏ –Ω–µ —Ö–æ—á—É –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è?</h2>

    <p>–õ–∞–¥–Ω–æ, —Ç–æ–≥–¥–∞ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ</p>

    <div class="flex justify-center">
        <button class="btn btn-primary btn-wide" onclick="onAnonAuth()">–ú–Ω–µ –ø–æ—Ö, —è –∞–Ω–æ–Ω üòé</button>
    </div>


    <script type="text/javascript">
        async function onTelegramAuth(user) {
            const resp = await fetch(
                'https://functions.yandexcloud.net/d4egqbhi7fbj2euj7tca',
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(user)
                }
            )
            if (resp.status === 200) {
                localStorage.setItem('tgAuth', JSON.stringify(user))
                window.location.href = '/';
            } else {
                alert('–ù–µ –ø–æ–≤–µ–∑–ª–æ —Ç–µ–±–µ üêº')
            }
        }

        async function onAnonAuth(user) {
            const {default: FingerprintJS} = await import('https://openfpcdn.io/fingerprintjs/v4');
            const fp = await FingerprintJS.load();
            const result = await fp.get();
            const visitorId = result.visitorId;

            const resp = await fetch(
                'https://functions.yandexcloud.net/d4egqbhi7fbj2euj7tca',
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({"type": "anon", "id": visitorId})
                }
            )
            if (resp.status === 200) {
                localStorage.setItem('tgAuth', JSON.stringify(user))
                window.location.href = '/';
            } else {
                alert('–ù–µ –ø–æ–≤–µ–∑–ª–æ —Ç–µ–±–µ üêº')
            }
        }
    </script>




{% endblock %}