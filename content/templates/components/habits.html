{% from 'templates/components/icons.html' import chart_bar %}


{% macro habit_table(habits, habit_rows) %}

    <table class="table-fixed  w-fit " id="habit-table">
        <thead>
        <tr>
            <th class="w-[100px] text-center"> ÐŸÑ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ° ðŸ‘‰ <br> Ð”Ð°Ñ‚Ð° ðŸ‘‡</th>
            {% for habit in habits %}
                <th class="w-[100px] text-wrap ">{{ habit }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for date_, habit_statuses in habit_rows.items() %}
            <tr class="text-center">
                <td class="!p-0">{{ date_ }}</td>
                {% for status in habit_statuses.values() %}
                    <td class="!p-0 {% if status == '+' %}bg-green-200{% elif status == '-' %}bg-red-200{% endif %} text-center  border-neutral-400 border  relative ">
                        <span>{% if status == '+' %}âž•{% elif status == '-' %}âž–{% endif %}</span>
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}

        </tbody>
    </table>
{% endmacro %}


{% macro habit_card(habit) %}
    <div class="card card-bordered card-compact   shadow habit-card" x-data="{showStats: false}">
        <div class="card-body gap-2">
            <div class=" flex-1">

                <div class="flex">
                    <div class="grow">
                        <h3 class=" !my-0">{{ habit.title }}</h3>

                    </div>

                </div>

                <div class="desc !py-0">{{ habit.desc }}</div>
            </div>



            <div>
                {% set weeks = 14 %}
                {% for day in range(7) %}
                    <div class="flex gap-1">
                        {% for week in range(weeks) %}
                            {% set i = day*weeks+week %}
                            {% set date_ = today_shift(7-(today_day) -weeks*7 + i%weeks*7 + i//weeks) %}
                            {% set perf = habit.get_performing(date_) %}
                            {% set status = perf.status %}
                            {% set nextStatus = '-' if status == '' else ('+' if status == '-' else '') %}

                            <div class="tooltip w-full" data-tip="{{ date_ }}">

                                <button hx-post="/habits/{{ habit.id }}/perform?date={{ date_ }}" hx-swap="outerHTML"
                                        hx-target="closest .habit-card" name="status" value="{{ nextStatus }}"
                                        class="aspect-square w-full rounded {% if date_ > today_date %}invisible{% endif %}  {% if status == '+' %}bg-success/20{% elif status == '-' %}bg-error/10{% else %}bg-neutral-50{% endif %}"></button>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            <div class="card-actions flex-nowrap   ">
                <button class="btn btn-sm grow btn-error {% if habit.current_status != '-' %}btn-outline{% endif %}"
                        type="button" hx-post="/habits/{{ habit.id }}/perform" hx-swap="outerHTML"
                        hx-target="closest .habit-card" name="status" value="-">ÐŸÑ€Ð¾ÐµÐ±Ð°Ð»
                </button>
                <button class="btn btn-sm grow btn-success {% if habit.current_status != '+' %}btn-outline{% endif %}"
                        type="button" hx-post="/habits/{{ habit.id }}/perform" hx-swap="outerHTML"
                        hx-target="closest .habit-card" name="status" value="+">Ð¡Ð´ÐµÐ»Ð°Ð»
                </button>
            </div>
        </div>
    </div>
{% endmacro %}


